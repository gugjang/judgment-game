<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŒë‹¨ì˜ ì‹ </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:Pretendard, Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:100%;
  max-width:420px;
  background:#1b1b1b;
  padding:24px;
  border-radius:16px;
}
h1,h2{text-align:center}
button{
  width:100%;
  padding:16px;
  margin-top:12px;
  border:none;
  border-radius:12px;
  font-size:18px;
  cursor:pointer;
  background:#2a2a2a;
  color:#fff;
}
button:hover{background:#333}
.hidden{display:none}
.bar{
  height:6px;
  background:#333;
  border-radius:4px;
  overflow:hidden;
  margin-top:16px;
}
.fill{
  height:100%;
  width:0%;
  background:#ff4d4d;
}
.rule{
  text-align:center;
  font-size:20px;
  margin-bottom:12px;
}
.char{
  font-size:64px;
  text-align:center;
  margin:16px 0;
}
</style>
</head>

<body>
<div class="container">

<div id="start">
  <h1>íŒë‹¨ì˜ ì‹ </h1>
  <button onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
</div>

<div id="survey" class="hidden">
  <h2 id="q"></h2>
  <div id="a"></div>
  <div class="bar"><div class="fill" id="surveyBar"></div></div>
</div>

<div id="result" class="hidden">
  <h2 id="typeName"></h2>
  <div class="char" id="char"></div>
  <p id="desc"></p>
  <button onclick="startGame()">ì´ ì„±í–¥ìœ¼ë¡œ ì‹œì‘</button>
</div>

<div id="game" class="hidden">
  <h2>ROUND <span id="round">1</span></h2>
  <div class="rule" id="ruleText"></div>
  <div id="choices"></div>
  <div class="bar"><div class="fill" id="gameBar"></div></div>
</div>

<div id="end" class="hidden">
  <h2>ê²Œì„ ì¢…ë£Œ</h2>
  <p id="score"></p>
  <button onclick="location.reload()">ë‹¤ì‹œ ë„ì „</button>
</div>

</div>

<script>
/* ---------- SURVEY ---------- */
const survey=[
["ê²°ì •í•  ë•Œ?",["ë°”ë¡œ","ìƒê°","ë¯¸ë£¸"]],
["ì‹¤íŒ¨í•˜ë©´?",["ì¬ë„ì „","ë¶„ì„","í¬ê¸°"]],
["ì••ë°• ìƒí™©?",["ë¬´ì‹œ","ì¸ì§€","ë¶ˆì•ˆ"]],
["ì„ íƒ ê¸°ì¤€?",["ì§ê°","ë…¼ë¦¬","íšŒí”¼"]],
["ê²Œì„ ì„±í–¥?",["ì¦‰ì‹œ","íŒ¨í„´","ë§ì„¤ì„"]],
["íŒë‹¨ ì†ë„?",["ë¹ ë¦„","ë³´í†µ","ëŠë¦¼"]],
["ê²°ì •ì„?",["ë¯¿ìŒ","ê²€ì¦","í”¼í•¨"]]
];

let idx=0, score=[0,0,0];
let surveyTimer, surveyStart;

/* ---------- START ---------- */
function startSurvey(){
  start.classList.add("hidden");
  surveyDiv.classList.remove("hidden");
  surveyStart=Date.now();
  surveyTimer=setInterval(updateSurveyBar,100);
  showQ();
}

function updateSurveyBar(){
  const t=(Date.now()-surveyStart)/60000*100;
  surveyBar.style.width=t+"%";
  if(t>=100){
    clearInterval(surveyTimer);
    showResult(true);
  }
}

function showQ(){
  q.textContent=`Q${idx+1}. ${survey[idx][0]}`;
  a.innerHTML="";
  survey[idx][1].forEach((t,i)=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.onclick=()=>{
      score[i]++;
      idx++;
      idx<survey.length?showQ():showResult(false);
    };
    a.appendChild(b);
  });
}

function showResult(timeout){
  clearInterval(surveyTimer);
  surveyDiv.classList.add("hidden");

  let type;
  const max=Math.max(...score);

  if(timeout) type="ë¶ˆì•ˆí˜•";
  else if(score.every(v=>v<4)) type="ìœ ë™í˜•";
  else if(score[0]===max) type="ì§ê°í˜•";
  else if(score[1]===max) type="ë¶„ì„í˜•";
  else type="íšŒí”¼í˜•";

  const map={
    "ì§ê°í˜•":["ì§ê°í˜•","ğŸ”º","ë¹ ë¥¸ íŒë‹¨ì„ ì‹ ë¢°í•œë‹¤"],
    "ë¶„ì„í˜•":["ë¶„ì„í˜•","ğŸ”·","ê·œì¹™ì„ íŒŒì•…í•˜ë ¤ í•œë‹¤"],
    "íšŒí”¼í˜•":["íšŒí”¼í˜•","âš«","ê²°ì •ì„ ë¯¸ë£¬ë‹¤"],
    "ìœ ë™í˜•":["ìœ ë™í˜•","ğŸŸ¢","ìƒí™©ì— ë”°ë¼ í”ë“¤ë¦°ë‹¤"],
    "ë¶ˆì•ˆí˜•":["ë¶ˆì•ˆí˜•","ğŸŸ£","ì‹œê°„ ì••ë°•ì— ì•½í•˜ë‹¤"]
  };

  typeName.textContent=map[type][0];
  char.textContent=map[type][1];
  desc.textContent=map[type][2];
  result.classList.remove("hidden");
}

/* ---------- GAME ---------- */
let round=1, rule=0;
let timeLimit=3, gameTimer;

function startGame(){
  result.classList.add("hidden");
  game.classList.remove("hidden");
  next();
}

function changeRule(){
  rule=Math.floor(Math.random()*3);
  ruleText.textContent=[
    "ê°€ì¥ í° ìˆ˜ë¥¼ ê³ ë¥´ì‹œì˜¤",
    "ê°€ì¥ ì‘ì€ ìˆ˜ë¥¼ ê³ ë¥´ì‹œì˜¤",
    "ê°€ìš´ë° ê°’ì„ ê³ ë¥´ì‹œì˜¤"
  ][rule];
}

function next(){
  if(round%5===1){
    changeRule();
    timeLimit=Math.max(1, timeLimit-0.5);
  }
  roundEl.textContent=round;
  choices.innerHTML="";
  const nums=[r(),r(),r()];
  nums.forEach(n=>{
    const b=document.createElement("button");
    b.textContent=n;
    b.onclick=()=>check(n,nums);
    choices.appendChild(b);
  });
  startGameTimer();
}

function startGameTimer(){
  let start=Date.now();
  gameBar.style.width="0%";
  clearInterval(gameTimer);
  gameTimer=setInterval(()=>{
    const p=(Date.now()-start)/(timeLimit*1000)*100;
    gameBar.style.width=p+"%";
    if(p>=100){end();}
  },50);
}

function check(n,arr){
  clearInterval(gameTimer);
  let c;
  if(rule===0) c=Math.max(...arr);
  if(rule===1) c=Math.min(...arr);
  if(rule===2){
    const s=[...arr].sort((a,b)=>a-b);
    c=s[1];
  }
  n===c?(round++,next()):end();
}

function end(){
  clearInterval(gameTimer);
  game.classList.add("hidden");
  endDiv.classList.remove("hidden");
  scoreP.textContent=`ìµœì¢… ë¼ìš´ë“œ: ${round}`;
}

function r(){return Math.floor(Math.random()*90)+10;}

/* ---------- DOM ---------- */
const start=document.getElementById("start");
const surveyDiv=document.getElementById("survey");
const q=document.getElementById("q");
const a=document.getElementById("a");
const surveyBar=document.getElementById("surveyBar");
const result=document.getElementById("result");
const typeName=document.getElementById("typeName");
const char=document.getElementById("char");
const desc=document.getElementById("desc");
const game=document.getElementById("game");
const choices=document.getElementById("choices");
const roundEl=document.getElementById("round");
const ruleText=document.getElementById("ruleText");
const gameBar=document.getElementById("gameBar");
const endDiv=document.getElementById("end");
const scoreP=document.getElementById("score");
</script>
</body>
</html>
