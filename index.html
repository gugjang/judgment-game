<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>판단의 신</title>
<style>
body {
  margin:0;
  background:#111;
  color:#fff;
  font-family: Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#app {
  width:90%;
  max-width:420px;
  text-align:center;
}
button {
  width:100%;
  padding:14px;
  margin:6px 0;
  font-size:18px;
  border:none;
  border-radius:10px;
  background:#333;
  color:white;
}
button:hover { background:#555; }
.timer {
  height:6px;
  background:#333;
  border-radius:3px;
  overflow:hidden;
  margin:10px 0;
}
.timer-fill {
  height:100%;
  background:#4caf50;
  width:100%;
}
.shape {
  font-size:80px;
}
</style>
</head>
<body>
<div id="app"></div>

<script>
const app = document.getElementById("app");

/* ================= 설문 ================= */
const survey = [
 ["결정할 때?", ["빠르게","판단"], ["분석","신중"], ["느낌","직감"], ["회피","회피"]],
 ["시간 압박 시?", ["밀어붙임","판단"], ["신중","신중"], ["직감","직감"], ["피함","회피"]],
 ["실수 후?", ["넘김","판단"], ["분석","신중"], ["괜찮","직감"], ["조심","회피"]],
 ["새 규칙?", ["적응","판단"], ["이해","신중"], ["시도","직감"], ["회피","회피"]],
 ["스타일?", ["공격","판단"], ["계산","신중"], ["감각","직감"], ["안정","회피"]],
 ["위험 상황?", ["결단","판단"], ["침착","신중"], ["직감","직감"], ["후퇴","회피"]],
 ["선택 기준?", ["속도","판단"], ["정확","신중"], ["감","직감"], ["안전","회피"]],
];

const shapes = {
 판단:{s:"▲",c:"#f44336",d:"빠른 결단"},
 신중:{s:"■",c:"#2196f3",d:"계산의 달인"},
 직감:{s:"●",c:"#ff9800",d:"감각의 화신"},
 회피:{s:"◆",c:"#9c27b0",d:"안정 우선"},
 불안:{s:"⬣",c:"#4caf50",d:"압박에 약함"}
};

let surveyIndex=0;
let scores={판단:0,신중:0,직감:0,회피:0};
let surveyStart;

/* 설문 타이머 */
function renderSurvey(){
 const [q,...answers] = survey[surveyIndex];
 app.innerHTML = `
 <h2>${q}</h2>
 <div class="timer"><div class="timer-fill" id="t"></div></div>
 ${answers.map(a=>`<button onclick="pick('${a[1]}')">${a[0]}</button>`).join("")}
 `;
}

function startSurvey(){
 surveyIndex=0;
 scores={판단:0,신중:0,직감:0,회피:0};
 surveyStart=performance.now();
 renderSurvey();
 requestAnimationFrame(updateSurveyTimer);
}

function updateSurveyTimer(t){
 const elapsed=(t-surveyStart)/1000;
 const left=Math.max(0,30-elapsed);
 document.getElementById("t").style.width=(left/30*100)+"%";
 if(left<=0){
   showResult("불안");
   return;
 }
 requestAnimationFrame(updateSurveyTimer);
}

function pick(type){
 scores[type]++;
 surveyIndex++;
 if(surveyIndex>=survey.length){
   const result=Object.entries(scores).sort((a,b)=>b[1]-a[1])[0][0];
   showResult(result);
 } else renderSurvey();
}

/* ================= 결과 ================= */
let character;

function showResult(type){
 character=type;
 const c=shapes[type];
 app.innerHTML=`
 <div class="shape" style="color:${c.c}">${c.s}</div>
 <h2>${type}형</h2>
 <p>${c.d}</p>
 <button onclick="startGame()">게임 시작</button>
 `;
}

/* ================= 게임 ================= */
let round,score,timeStart;

function startGame(){
 round=1; score=0;
 nextRound();
}

function nextRound(){
 const isHard = round>10;
 const count = isHard ? 4 : 3;
 const nums=[];
 while(nums.length<count){
  const n=Math.floor(Math.random()*90)+10;
  if(!nums.includes(n)) nums.push(n);
 }

 let rule;
 if(!isHard){
   rule = Math.floor(Math.random()*3);
 } else {
   rule = Math.floor(Math.random()*5);
 }

 let text, answer;
 if(rule===0){ text="가장 큰 수"; answer=Math.max(...nums); }
 if(rule===1){ text="가장 작은 수"; answer=Math.min(...nums); }
 if(rule===2){
   const s=[...nums].sort((a,b)=>a-b);
   answer=s[Math.floor(s.length/2)];
   text="중간 수";
 }
 if(rule===3){
   answer = nums.sort((a,b)=>String(b)[0]-String(a)[0])[0];
   text="첫 자리 수가 가장 큰 수";
 }
 if(rule===4){
   answer = nums.sort((a,b)=>digitSum(a)-digitSum(b))[0];
   text="자릿수 합이 가장 작은 수";
 }

 app.innerHTML=`
 <h3>Round ${round}</h3>
 <h2>${text}</h2>
 <div class="timer"><div class="timer-fill" id="gt"></div></div>
 ${nums.map(n=>`<button onclick="choose(${n},${answer})">${n}</button>`).join("")}
 `;

 timeStart=performance.now();
 requestAnimationFrame(gameTimer);
}

function gameTimer(t){
 const left=5-(t-timeStart)/1000;
 document.getElementById("gt").style.width=(left/5*100)+"%";
 if(left<=0){ endGame(); return; }
 requestAnimationFrame(gameTimer);
}

function choose(n,a){
 if(n===a){
   score++;
   round++;
   if(round===11){
     app.innerHTML=`<h2>이제부터 더 어려워집니다</h2><button onclick="nextRound()">계속하기</button>`;
   } else nextRound();
 } else endGame();
}

function endGame(){
 app.innerHTML=`
 <h1>${score}점</h1>
 <p>${score>=15?"오… 잘하시네요":"아직 연습이 필요합니다"}</p>
 <button onclick="startSurvey()">다시 하기</button>
 `;
}

function digitSum(n){ return [...String(n)].reduce((a,b)=>a+Number(b),0); }

/* 시작 */
app.innerHTML=`<h1>판단의 신</h1><button onclick="startSurvey()">시작하기</button>`;
</script>
</body>
</html>
