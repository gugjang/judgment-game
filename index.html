<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŒë‹¨ì˜ ì‹ </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:Pretendard, Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:100%;
  max-width:420px;
  background:#1c1c1c;
  padding:24px;
  border-radius:18px;
}
h1,h2{text-align:center}
button{
  width:100%;
  padding:16px;
  margin-top:12px;
  border:none;
  border-radius:14px;
  font-size:18px;
  background:#2a2a2a;
  color:#fff;
}
.hidden{display:none}
.bar{
  height:6px;
  background:#333;
  border-radius:4px;
  overflow:hidden;
  margin-top:16px;
}
.fill{
  height:100%;
  width:0%;
  background:#ff5555;
}
.rule{
  font-size:22px;
  text-align:center;
  margin-bottom:14px;
}
.bigScore{
  font-size:72px;
  text-align:center;
}
.comment{
  text-align:center;
  font-size:20px;
}
.noticeBig{
  font-size:48px;
  text-align:center;
}
.noticeText{
  text-align:center;
  font-size:18px;
  margin:12px 0;
}
</style>
</head>

<body>
<div class="container">

<!-- START -->
<div id="start">
  <h1>íŒë‹¨ì˜ ì‹ </h1>
  <button onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
</div>

<!-- SURVEY -->
<div id="survey" class="hidden">
  <h2 id="q"></h2>
  <div id="answers"></div>
  <div class="bar"><div class="fill" id="surveyBar"></div></div>
</div>

<!-- RESULT -->
<div id="result" class="hidden">
  <h2 id="typeName"></h2>
  <p id="desc"></p>
  <button onclick="startGame()">ì´ ì„±í–¥ìœ¼ë¡œ ì‹œì‘</button>
</div>

<!-- NOTICE -->
<div id="notice" class="hidden">
  <div class="noticeBig">ROUND 6</div>
  <div class="noticeText">
    ì œí•œ ì‹œê°„ì´ <b>3ì´ˆ</b>ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤<br>
    ê·œì¹™ ë³€ê²½<br><br>
    ğŸ‘‰ <b>ê°€ìš´ë° ìˆ«ìë¥¼ ê³ ë¥´ì‹œì˜¤</b>
  </div>
  <button onclick="continueGame()">ê³„ì†í•˜ê¸°</button>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <h2>ROUND <span id="round">1</span></h2>
  <div class="rule" id="ruleText"></div>
  <div id="choices"></div>
  <div class="bar"><div class="fill" id="gameBar"></div></div>
</div>

<!-- END -->
<div id="end" class="hidden">
  <div class="bigScore"><span id="finalScore"></span>ì </div>
  <div class="comment" id="comment"></div>
  <button onclick="location.reload()">ë‹¤ì‹œ ë„ì „</button>
</div>

</div>

<script>
/* ---------- SURVEY ---------- */
const survey=[
["ê²°ì •í•  ë•Œ?",["ë°”ë¡œ","ìƒê°","ë¯¸ë£¸"]],
["ì‹¤íŒ¨í•˜ë©´?",["ì¬ë„ì „","ë¶„ì„","í¬ê¸°"]],
["ì••ë°• ìƒí™©?",["ë¬´ì‹œ","ì¸ì§€","ë¶ˆì•ˆ"]],
["ì„ íƒ ê¸°ì¤€?",["ì§ê°","ë…¼ë¦¬","íšŒí”¼"]],
["ê²Œì„ ì„±í–¥?",["ì¦‰ì‹œ","íŒ¨í„´","ë§ì„¤ì„"]],
["íŒë‹¨ ì†ë„?",["ë¹ ë¦„","ë³´í†µ","ëŠë¦¼"]],
["ê²°ì •ì„?",["ë¯¿ìŒ","ê²€ì¦","í”¼í•¨"]]
];
let sIdx=0, sScore=[0,0,0];
let surveyStart, surveyTimer;

function startSurvey(){
  start.classList.add("hidden");
  surveyDiv.classList.remove("hidden");
  surveyStart=Date.now();
  surveyTimer=setInterval(()=>{
    const p=(Date.now()-surveyStart)/30000*100;
    surveyBar.style.width=p+"%";
    if(p>=100) showResult(true);
  },100);
  showQ();
}

function showQ(){
  q.textContent=`Q${sIdx+1}. ${survey[sIdx][0]}`;
  answers.innerHTML="";
  survey[sIdx][1].forEach((t,i)=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.onclick=()=>{
      sScore[i]++; sIdx++;
      sIdx<survey.length?showQ():showResult(false);
    };
    answers.appendChild(b);
  });
}

function showResult(timeout){
  clearInterval(surveyTimer);
  surveyDiv.classList.add("hidden");

  let type="ìœ ë™í˜•";
  if(timeout) type="ë¶ˆì•ˆí˜•";
  else if(Math.max(...sScore)>=4){
    type=["ì§ê°í˜•","ë¶„ì„í˜•","íšŒí”¼í˜•"][sScore.indexOf(Math.max(...sScore))];
  }

  typeName.textContent=type;
  desc.textContent="ë‹¹ì‹ ì˜ íŒë‹¨ ì„±í–¥ì…ë‹ˆë‹¤";
  result.classList.remove("hidden");
}

/* ---------- GAME ---------- */
let round=1;
let rule=0; // 0=í°ìˆ˜, 1=ì‘ì€ìˆ˜, 2=ê°€ìš´ë°
let timeLimit=5;
let noticeShown=false;
let gameTimer;

function startGame(){
  result.classList.add("hidden");
  game.classList.remove("hidden");
  setRule(0);
  nextRound();
}

function setRule(r){
  rule=r;
  ruleText.textContent=[
    "ê°€ì¥ í° ìˆ˜ë¥¼ ê³ ë¥´ì‹œì˜¤",
    "ê°€ì¥ ì‘ì€ ìˆ˜ë¥¼ ê³ ë¥´ì‹œì˜¤",
    "ê°€ìš´ë° ìˆ«ìë¥¼ ê³ ë¥´ì‹œì˜¤"
  ][r];
}

function nextRound(){
  roundEl.textContent=round;

  if(round===6 && !noticeShown){
    noticeShown=true;
    game.classList.add("hidden");
    notice.classList.remove("hidden");
    timeLimit=3;
    setRule(2);
    return;
  }

  choices.innerHTML="";
  const nums=[r(),r(),r()];
  nums.forEach(n=>{
    const b=document.createElement("button");
    b.textContent=n;
    b.onclick=()=>check(n,nums);
    choices.appendChild(b);
  });

  startTimer();
}

function continueGame(){
  notice.classList.add("hidden");
  game.classList.remove("hidden");
  nextRound();
}

function startTimer(){
  let start=Date.now();
  gameBar.style.width="0%";
  clearInterval(gameTimer);
  gameTimer=setInterval(()=>{
    const p=(Date.now()-start)/(timeLimit*1000)*100;
    gameBar.style.width=p+"%";
    if(p>=100) endGame();
  },50);
}

function check(n,arr){
  clearInterval(gameTimer);
  let correct;
  if(rule===0) correct=Math.max(...arr);
  if(rule===2){
    const s=[...arr].sort((a,b)=>a-b);
    correct=s[1];
  }
  n===correct?(round++,nextRound()):endGame();
}

function endGame(){
  game.classList.add("hidden");
  endDiv.classList.remove("hidden");
  finalScore.textContent=round-1;

  let msg="ìŒâ€¦ ì•„ì§ ê°ì„ ëª» ì¡ì•˜ë„¤ìš”";
  if(round>4) msg="ì˜¤, ì¡°ê¸ˆ í•˜ì‹œë„¤ìš”?";
  if(round>8) msg="ì´ê±´ ê½¤ ì˜í•˜ëŠ”ë°ìš”?";
  if(round>13) msg="íŒë‹¨ë ¥ ì¥ì¸ì…ë‹ˆë‹¤";
  if(round>20) msg="ë‹¹ì‹ ì€ íŒë‹¨ì˜ ì‹ ì…ë‹ˆë‹¤";
  comment.textContent=msg;
}

function r(){return Math.floor(Math.random()*90)+10;}

/* DOM */
const start=document.getElementById("start");
const surveyDiv=document.getElementById("survey");
const q=document.getElementById("q");
const answers=document.getElementById("answers");
const surveyBar=document.getElementById("surveyBar");
const result=document.getElementById("result");
const typeName=document.getElementById("typeName");
const desc=document.getElementById("desc");
const notice=document.getElementById("notice");
const game=document.getElementById("game");
const choices=document.getElementById("choices");
const roundEl=document.getElementById("round");
const ruleText=document.getElementById("ruleText");
const gameBar=document.getElementById("gameBar");
const endDiv=document.getElementById("end");
const finalScore=document.getElementById("finalScore");
const comment=document.getElementById("comment");
</script>
</body>
</html>
